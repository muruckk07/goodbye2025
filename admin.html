<!DOCTYPE html>
<html lang="ko">
  <head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Í¥ÄÎ¶¨Ïûê - GoodBye 2025</title>
    <style>
      :root {
        --bg: #07080c;
        --card: rgba(255,255,255,.06);
        --line: rgba(255,255,255,.12);
        --txt: rgba(255,255,255,.92);
        --muted: rgba(255,255,255,.68);
        --btn: #ffffff;
        --btnTxt: #0b0c10;
        --danger: #ffb4b4;
      }
      * { box-sizing: border-box; }
      html, body { margin: 0; padding: 0; }
      body {
        font-family: ui-sans-serif, system-ui, -apple-system, Segoe UI, Roboto, "Apple SD Gothic Neo", "Noto Sans KR", Arial;
        color: var(--txt);
        background:
          radial-gradient(1000px 520px at 15% -10%, rgba(255,255,255,.14), transparent 55%),
          radial-gradient(900px 520px at 110% 10%, rgba(120,160,255,.18), transparent 55%),
          radial-gradient(800px 420px at 60% 110%, rgba(255,140,200,.10), transparent 55%),
          var(--bg);
        overflow-x: hidden;
      }

      .safe { padding: 18px 16px 28px; }
      .container { max-width: 600px; margin: 0 auto; }

      .header {
        display: flex;
        justify-content: space-between;
        align-items: center;
        margin-bottom: 24px;
      }
      .header h1 {
        font-size: 28px;
        font-weight: 950;
        margin: 0;
      }
      .header-actions {
        display: flex;
        gap: 8px;
      }

      .stats {
        display: grid;
        grid-template-columns: 1fr 1fr;
        gap: 12px;
        margin-bottom: 24px;
      }
      .stat-card {
        border: 1px solid var(--line);
        background: var(--card);
        border-radius: 18px;
        padding: 16px;
        backdrop-filter: blur(10px);
      }
      .stat-label {
        font-size: 13px;
        color: var(--muted);
        margin-bottom: 6px;
      }
      .stat-value {
        font-size: 32px;
        font-weight: 950;
      }

      .btn {
        display: inline-block;
        padding: 10px 14px;
        border-radius: 10px;
        background: var(--btn);
        color: var(--btnTxt);
        font-weight: 950;
        border: none;
        cursor: pointer;
        font-size: 13px;
        transition: transform .12s ease;
      }
      .btn:active { transform: scale(.98); }
      .btn.secondary {
        background: rgba(255,255,255,.08);
        color: var(--txt);
      }

      .list-container {
        border: 1px solid var(--line);
        background: var(--card);
        border-radius: 18px;
        backdrop-filter: blur(10px);
        overflow: hidden;
      }
      .list-header {
        padding: 14px;
        border-bottom: 1px solid var(--line);
        font-weight: 950;
        font-size: 14px;
      }
      .list-item {
        padding: 14px;
        border-bottom: 1px solid rgba(255,255,255,.06);
        display: flex;
        justify-content: space-between;
        align-items: flex-start;
        gap: 12px;
      }
      .list-item:last-child {
        border-bottom: none;
      }
      .item-info {
        flex: 1;
      }
      .item-name {
        font-weight: 850;
        margin-bottom: 4px;
      }
      .item-message {
        font-size: 13px;
        color: var(--muted);
        line-height: 1.4;
        margin-bottom: 4px;
      }
      .item-time {
        font-size: 12px;
        color: rgba(255,255,255,.5);
      }
      .item-delete {
        background: rgba(255,180,180,.12);
        color: var(--danger);
        border: none;
        padding: 6px 10px;
        border-radius: 8px;
        cursor: pointer;
        font-size: 12px;
        font-weight: 900;
        transition: background .12s ease;
      }
      .item-delete:hover {
        background: rgba(255,180,180,.2);
      }

      .empty-state {
        padding: 40px 20px;
        text-align: center;
        color: var(--muted);
      }
      .empty-state-icon {
        font-size: 48px;
        margin-bottom: 12px;
      }

      .modal-backdrop {
        position: fixed;
        inset: 0;
        background: rgba(0,0,0,.55);
        opacity: 0;
        pointer-events: none;
        transition: opacity .22s ease;
        z-index: 40;
      }
      .modal-backdrop.open {
        opacity: 1;
        pointer-events: auto;
      }

      .modal {
        position: fixed;
        left: 50%;
        top: 50%;
        transform: translate(-50%, -50%) scale(.95);
        opacity: 0;
        pointer-events: none;
        transition: opacity .22s ease, transform .22s ease;
        z-index: 45;
      }
      .modal.open {
        opacity: 1;
        pointer-events: auto;
        transform: translate(-50%, -50%) scale(1);
      }
      .modal-content {
        background: rgba(15,16,22,.92);
        border: 1px solid rgba(255,255,255,.14);
        border-radius: 18px;
        padding: 20px;
        max-width: 400px;
        backdrop-filter: blur(12px);
      }
      .modal-title {
        font-weight: 950;
        font-size: 18px;
        margin-bottom: 12px;
      }
      .modal-text {
        color: var(--muted);
        margin-bottom: 20px;
        line-height: 1.5;
      }
      .modal-actions {
        display: flex;
        gap: 8px;
      }
      .modal-actions .btn {
        flex: 1;
      }
    </style>
  </head>
  <body>
    <div class="safe">
      <div class="container">

        <!-- Header -->
        <div class="header">
          <h1>Ïã†Ï≤≠ ÌòÑÌô©</h1>
          <div class="header-actions">
            <button class="btn secondary" id="exportBtn">CSV Îã§Ïö¥Î°úÎìú</button>
            <button class="btn secondary" id="clearBtn">Ï†ÑÏ≤¥ ÏÇ≠Ï†ú</button>
          </div>
        </div>

        <!-- Stats -->
        <div class="stats">
          <div class="stat-card">
            <div class="stat-label">Ï¥ù Ïã†Ï≤≠Ïûê</div>
            <div class="stat-value" id="totalCount">0</div>
          </div>
          <div class="stat-card">
            <div class="stat-label">ÎßàÏßÄÎßâ Ïã†Ï≤≠</div>
            <div class="stat-value" id="lastTime" style="font-size: 14px;">-</div>
          </div>
        </div>

        <!-- List -->
        <div class="list-container">
          <div class="list-header">Ïã†Ï≤≠Ïûê Î™©Î°ù</div>
          <div id="listContent"></div>
        </div>

      </div>
    </div>

    <!-- Confirm Modal -->
    <div class="modal-backdrop" id="modalBackdrop"></div>
    <div class="modal" id="modal">
      <div class="modal-content">
        <div class="modal-title" id="modalTitle">ÌôïÏù∏</div>
        <div class="modal-text" id="modalText"></div>
        <div class="modal-actions">
          <button class="btn secondary" id="modalCancel">Ï∑®ÏÜå</button>
          <button class="btn" id="modalConfirm">ÏÇ≠Ï†ú</button>
        </div>
      </div>
    </div>

    <script>
      const listContent = document.getElementById("listContent");
      const totalCount = document.getElementById("totalCount");
      const lastTime = document.getElementById("lastTime");
      const exportBtn = document.getElementById("exportBtn");
      const clearBtn = document.getElementById("clearBtn");
      const modalBackdrop = document.getElementById("modalBackdrop");
      const modal = document.getElementById("modal");
      const modalTitle = document.getElementById("modalTitle");
      const modalText = document.getElementById("modalText");
      const modalCancel = document.getElementById("modalCancel");
      const modalConfirm = document.getElementById("modalConfirm");

      let pendingAction = null;

      function loadRsvpList() {
        const rsvpList = JSON.parse(localStorage.getItem("rsvpList")) || [];
        renderList(rsvpList);
        updateStats(rsvpList);
      }

      function renderList(rsvpList) {
        if (rsvpList.length === 0) {
          listContent.innerHTML = `
            <div class="empty-state">
              <div class="empty-state-icon">üì≠</div>
              <div>ÏïÑÏßÅ Ïã†Ï≤≠ÏûêÍ∞Ä ÏóÜÏäµÎãàÎã§.</div>
            </div>
          `;
          return;
        }

        // ÏµúÏã†Ïàú Ï†ïÎ†¨
        const sorted = [...rsvpList].sort((a, b) => b.id - a.id);

        listContent.innerHTML = sorted.map(item => `
          <div class="list-item">
            <div class="item-info">
              <div class="item-name">${escapeHtml(item.name)}</div>
              <div class="item-message">"${escapeHtml(item.message)}"</div>
              <div class="item-time">${item.timestamp}</div>
            </div>
            <button class="item-delete" data-id="${item.id}">ÏÇ≠Ï†ú</button>
          </div>
        `).join("");

        // ÏÇ≠Ï†ú Î≤ÑÌäº Ïù¥Î≤§Ìä∏
        document.querySelectorAll(".item-delete").forEach(btn => {
          btn.addEventListener("click", (e) => {
            const id = parseInt(e.target.dataset.id);
            const item = rsvpList.find(x => x.id === id);
            openConfirmModal(
              `${escapeHtml(item.name)} ÏÇ≠Ï†ú`,
              `"${escapeHtml(item.name)}"Ïùò Ïã†Ï≤≠ÏùÑ ÏÇ≠Ï†úÌïòÏãúÍ≤†ÏäµÎãàÍπå?`,
              () => deleteItem(id)
            );
          });
        });
      }

      function updateStats(rsvpList) {
        totalCount.textContent = rsvpList.length;
        if (rsvpList.length > 0) {
          const latest = rsvpList.reduce((a, b) => a.id > b.id ? a : b);
          lastTime.textContent = latest.timestamp;
        } else {
          lastTime.textContent = "-";
        }
      }

      function deleteItem(id) {
        let rsvpList = JSON.parse(localStorage.getItem("rsvpList")) || [];
        rsvpList = rsvpList.filter(item => item.id !== id);
        localStorage.setItem("rsvpList", JSON.stringify(rsvpList));
        loadRsvpList();
        closeModal();
      }

      function exportCSV() {
        const rsvpList = JSON.parse(localStorage.getItem("rsvpList")) || [];
        if (rsvpList.length === 0) {
          alert("ÎÇ¥Î≥¥ÎÇº Îç∞Ïù¥ÌÑ∞Í∞Ä ÏóÜÏäµÎãàÎã§.");
          return;
        }

        // CSV Ìó§Îçî
        const headers = ["Ïù¥Î¶Ñ", "Ìïú ÎßàÎîî", "Ïã†Ï≤≠ ÏãúÍ∞Ñ"];
        const rows = rsvpList.map(item => [
          item.name,
          item.message,
          item.timestamp
        ]);

        // CSV Î¨∏ÏûêÏó¥ ÏÉùÏÑ±
        let csv = headers.join(",") + "
";
        rows.forEach(row => {
          csv += row.map(cell => `"${cell.replace(/"/g, '""')}"`).join(",") + "\n";
        });

        // Îã§Ïö¥Î°úÎìú
        const blob = new Blob([csv], { type: "text/csv;charset=utf-8;" });
        const link = document.createElement("a");
        const url = URL.createObjectURL(blob);
        link.setAttribute("href", url);
        link.setAttribute("download", `goodbye2025_rsvp_${new Date().toISOString().split('T')[0]}.csv`);
        link.click();
      }

      function openConfirmModal(title, text, onConfirm) {
        modalTitle.textContent = title;
        modalText.textContent = text;
        pendingAction = onConfirm;
        modalBackdrop.classList.add("open");
        modal.classList.add("open");
      }

      function closeModal() {
        modalBackdrop.classList.remove("open");
        modal.classList.remove("open");
        pendingAction = null;
      }

      function escapeHtml(text) {
        const div = document.createElement("div");
        div.textContent = text;
        return div.innerHTML;
      }

      // Ïù¥Î≤§Ìä∏ Î¶¨Ïä§ÎÑà
      exportBtn.addEventListener("click", exportCSV);
      clearBtn.addEventListener("click", () => {
        openConfirmModal(
          "Ï†ÑÏ≤¥ ÏÇ≠Ï†ú",
          "Î™®Îì† Ïã†Ï≤≠ Îç∞Ïù¥ÌÑ∞Î•º ÏÇ≠Ï†úÌïòÏãúÍ≤†ÏäµÎãàÍπå? Ïù¥ ÏûëÏóÖÏùÄ ÎêòÎèåÎ¶¥ Ïàò ÏóÜÏäµÎãàÎã§.",
          () => {
            localStorage.removeItem("rsvpList");
            loadRsvpList();
            closeModal();
          }
        );
      });
      modalCancel.addEventListener("click", closeModal);
      modalConfirm.addEventListener("click", () => {
        if (pendingAction) pendingAction();
      });
      modalBackdrop.addEventListener("click", closeModal);

      // Ï¥àÍ∏∞ Î°úÎìú
      loadRsvpList();
    </script>
  </body>
</html>